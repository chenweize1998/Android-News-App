# JAVA 新闻APP 报告

## 2017013588 计74 陈暐泽		2017013617 计76 彭皓

### 1 功能实现

| 功能       | 子功能                                                       | 百分比（%） | 是否实现 |
| ---------- | ------------------------------------------------------------ | ----------- | -------- |
| 系统支持   | 要保证程序在安卓机上正常运行，测试过程中程序不崩溃           | 8           | 是       |
| 页面布局   | 布局合理，点击处理正确                                       | 8           | 是       |
| 分类列表   | 删除和添加操作                                               | 4           | 是       |
| 新闻列表   | 正确显示新闻列表的消息，布局和展示，点击进入新闻详情页面正确。 | 8           | 是       |
|            | 实现新闻的本地存储，看过的新闻列表在离线的情况下也可以浏览。新闻是否看过的页面灰色标记。 | 8           | 是       |
|            | 上拉获取更多新闻，下拉刷新最新新闻。                         | 4           | 是       |
|            | 显示新闻的来源和时间                                         | 4           | 是       |
|            | 新闻关键词搜索，历史记录                                     | 4           | 是       |
| 分享收藏   | 使用微信、微博等SDK分享，新闻详情页面点击分享可以分享到常用的app，分享内容带有新闻摘要、URL和图片 | 4           | 是       |
|            | 新闻详情页面点击收藏的添加和删除，实现收藏新闻的本地存储。收藏页的正确展示，点击可以进入新闻详情等 | 8           | 是       |
| 新闻推荐   | 根据用户看过的新闻推荐相关的新闻，参考今日头条等             | 8           | 是       |
|            | **附加功能**                                                 |             |          |
| 夜间模式   | 此功能主要为了减小应用在夜间对用户眼睛的光刺激，可以帮助用户在夜晚获得更好的用户体验 | 4           | 是       |
| 关键词屏蔽 | 此功能主要为了使得用户能够选择屏蔽自己不喜欢的话题（词语），获得更好地用户体验 | 4           | 是       |
| 登录功能   | 此功能主要为了让用户能够在云端储存自己的用户信息以及阅读兴趣。 | 8           | 是       |
| 评论功能   | 此功能为了让用户能够更方便地发表自己对新闻的看法，并看到其它用户的想法 | 8           | 是       |
| 发布功能   | 此功能为了让用户除了看新闻以外，还能自己发布信息、转发新闻，增强用户粘性 | 8           | 是       |
| 关注功能   | 此功能为了让用户还能够关注自己所感兴趣的用户，获得他们所发布和转发的新闻。 | 8           | 是       |

### 2 具体实现

#### 2.1 应用初始界面

![](.\pics\front_page.jpg)

打开APP后进入MainActivity中，在本应用的设计中，这只作为一个跳转页，展示应用的封面，如上图。设置一个三秒的计时器，到时后有两种可能性：

1. 手机第一次打开本应用，进入动画界面。
2. 非第一次打开，直接进入新闻列表。

#### 2.2 开篇动画

使用[`TextSurface`](https://github.com/elevenetc/TextSurface)包进行绘制。动画结束后，自动渐变进入新闻列表。但由于这个包5年前就停止维护了，导致某些效果无法使用，调试了很久，最终大致效果如下图。

![](.\pics\opening_animation.gif)

#### 2.3 使用Fragment

由于新闻分类显示、历史新闻、收藏新闻、搜索新闻都是类似的，都是对新闻进行逐条显示，所以考虑使用`Fragment`在这几个功能之间进行切换。所以这些界面都设置为了Fragment。切换时只要`commit`上一个新的`Fragment`就可以了，不用反复打开关闭`Activity`。

##### 2.3.1 新闻分类显示的Fragment

新闻列表的主体由三部分组成：

1. 一个可以随着下滑而隐藏的标题栏
2. 一个可以左右滑动的类别列表
3. 一个可以上下滑动的新闻列表

![](D:\AndroidStudioProjects\news_list.png)![](D:\AndroidStudioProjects\search.png)

具体如上左图所示。具体实现为

**标题栏**

随着用户上滑，标题栏将逐渐向上隐藏，一旦下滑，标题栏将再次出现。这一实现依靠的是Google官方提供的`CollapsingToolbarLayout`。在这一layout中放入一个`ImageView`用来显示标题栏图片，然后在右侧放置一个`SearchView`。这一`SearchView`可以被点击，点击后整个标题栏都将称为输入搜索关键词的输入框，如上右图所示(此图是在夜间模式下的截图)

**分类列表**

分类列表使用一个`RecyclerView`来实现，以支持左右滑动。在对应的`Adapter`中维护一个`lastClicked`变量，记录上次点击了哪个类（初始为null），然后为每一个类别绑定一个`onClickListener`，只要被点击了，就将`lastClicked`对应的类别背景变黑，高亮当前类别背景，并更新`lastClicked`变量，最后按照类别请求。

右侧有一个按钮，按下之后可以进入到对类别进行增加/删除以及排序操作的界面，如下左图所示

![](D:\AndroidStudioProjects\cat_rearrange.png)![](.\pics\news_item.png)

上下各有一个自定义的`GridLayout`，实现了拖动时半透明的功能，以及实时插入所在位置的效果。在`我的频道`中点击对应的频道，可以删除，在`隐藏的频道`中点击被删除的分类，可以恢复，长按可以进行分类的拖动排序。

后期感到使用`RecyclerView`来实现分类列表实在不算是一个好的选择。似乎可以使用和Tab相关的一些Layout来进行实现，似乎会方便很多，不用自己进行选择高亮等操作。

**新闻列表**

使用的是`RecyclerView`。其中每一个`View`使用的是在`CardView`。在每个`CardView`中有一个位于顶部的`ImageView`，用于显示新闻的第一张图片（如果有的话），如果新闻没有图片，则将`ImageView`的`visibility`设置为`GONE`。下方是加粗的标题文字以及新闻中的第一句话（如果第一句话长度长于100，则截断加省略号）。左下方用一个方框将关键词装入，右下方包含有一个发布者头像（只在用户转发的新闻或是用户自己发布的消息中显示）、转发按钮、一个收藏按钮（收藏后被点亮）。

整个`View`被设置了一个`onClickListener`，一旦被点击，则可以进入对应新闻的详情页。

下拉刷新以及上拉加载的实现基于[`SmartRefreshLayout`](https://github.com/scwang90/SmartRefreshLayout)，这是一个第三方包，可以方便地实现下拉刷新和上拉加载的逻辑。

每一个新闻列表中的项可见上右图

**发布按钮**

可以注意到在页面右下角存在一个圆形浮动按钮，基于Google官方提供的`FloatingActionButton`实现，后期会进行介绍。

#### 2.4 新闻详情页

由于不知道新闻中到底会有几张图片，所以很难动态地在新闻文字当中插入图片。因此我们的想法就是在页顶设置一个`ViewPager`，可以左右滑动查看新闻包含的所有图片，由于要让整个布局随着图片的大小调整高度过于耗费资源，而且容易出现bug，所以采用固定高度的策略。这样会造成某些图片无法显示完全，因此在每一张图片上设置了一个`onClickListener`来监听点击事件，一旦被点击，则通过一个没有选项的对话框展示图片，如下图所示。

![](.\pics\news_page_pic.png)![](.\pics\comment.png)

底部存在一个可随着滑动隐藏和出现的底栏，其中可以输入评论，也可以在其中进行分享和收藏操作。右上图中我们给出了一个展示评论的例子（假的新闻）。

#### ！！！2.5 历史新闻

> ！！！需要后端内容补充

在新闻列表中监听点击事件，点击新闻的同时，除了打开新闻详情页以外，还在后端将该新闻加入到数据库中，同时将会把新闻标题置为灰色。

#### ！！！2.6 收藏新闻

> ！！！需要后端内容补充

在新闻列表中对收藏按钮监听点击事件。应用中的收藏按钮都基于[ShineButton](https://github.com/ChadCSong/ShineButton)实现，它用简洁的方式提供了优秀的交互效果。用户对按钮进行点击后，将有动画反馈。与此同时，检查点击后的状态来判断是删除收藏还是添加收藏，并更新到后端数据库中。具体效果可见下图

![](.\pics\shinebutton.gif)

#### ！！2.7 搜索新闻

> 不知道有没有后端？

通过`Android`官方提供的`SearchView`来完成搜索功能的配置。具体步骤与[官网上的教程](https://developer.android.com/guide/topics/search/search-dialog)一致。只不过在`Search Activity`当中执行的是将`query`作为查询关键词，输入到`api`中，获得返回的新闻。

#### ！！！2.8 关键词屏蔽

> 后端提一嘴怎么存的就行？

##### 2.8.1 设计思路

「屏蔽」所引起的联想似乎都不太美好：于应用管理者而言，屏蔽虽然在一定程度上提高了内容质量的下限，但可能同时也意味着对某些潜在价值观的抵制；于使用者而言，屏蔽是最简便的“眼不见为净”的践行方式，但可能同时也意味着信息茧房的不断收束。

![](.\pics\filter.png)

所以前端在这一功能的UI设计上，将一句问句与所要填写的屏蔽词结合，希望能够引起用户的思考“屏蔽这个词，不再接受这个词的任何新闻，真的好吗？”。以噪声的波形图作为背景，辅以故障风的文字，试图营造出一个并不舒适的环境，并隐式地传递给用户设计者的立场。

##### 2.8.2 实现

背景只是贴图，耳朵也是一个`ImageView`。运用`FrameLayout`可以将三个`TextView`进行叠加，分别设置不同的垂直方向偏移量以及不同的颜色，即可以最简单的方式形成故障风的文字。

Filter Words的显示复用了之前在分类排序中的`GridLayout`。

#### ！！！2.9 查找好友

> 需要后端

![](.\pics\friend.png)

##### 2.9.1 设计思路

既然要做社交，那么就应该鼓励用户使用社交功能多与其它用户进行互动交流分享。所以选图时的一种思路是找到很多人在一起social的场景；一种思路是突出独身与社交的冲突；还有一种思路是反应当下人们过分沉浸于自我的世界中而疏于与身边人交互的状态。色彩上，应用黑白灰的主色调并不太适合社交的活跃性，因此希望是鲜明或存在明显对比冲突的。最后选择了最后一种思路，挑了这样一张图，两个人擦肩而过却都低头看着手机，同时还存在明显的色彩冲突。蒙上一层黑色的半透明层就可以作为底图了。

在Android Studio中可以选择Google Font上的字体，原字体过于沉闷，所以选择了更具有灵性的一个字体作为标题字体。

##### 2.9.2 实现

主体是下方的一个`RecyclerView`。由于Android没有自带圆形的`ImageView`，因此其实使用了一个`CardView`，设置了圆角，并令其半径就是`CardView`宽度的一半，再在里面放上`ImageView`就成了一个圆形头像。为每个人的头像设置了点击事件的监听，点击后可以进入此人的个人主页（展示此人转发的新闻和发布的消息）（没有截图）。

#### ！！！2.10 登陆

> 需要后端！

![](.\pics\login.png)

登陆界面挺简单的，两句Slogan加上传统的登陆信息就构成了这个界面。`Get to Know the World`表明了我们希望我们的应用能够帮助用户了解到世界上发生的各种各样的事件，而`News are temporary, pride is forever`中的`pride`更多的想指我们所做出这个APP所产生的成就感。

Slogan下的一条红横线其实是一个高度为1dp的View，不是实际的线。三个输入框是官方提供的`TextInputEditText`，下面两个按钮就是普通的`Button`

#### ！！！2.11 发布消息

> 需要后端！

![](.\pics\andy.png)

##### 2.11.1 设计思路

对于用户自己发布信息我们是持鼓励态度的，毕竟社交功能是我们这个APP一个很重要的功能。在完成这一页面的设计时，一个模板当然就是每天都在使用的微信（添加图片的+图标就是仿的微信）。但由于我们是一个新闻APP，发布的消息希望能够有标题和正文，所以最后分了两栏分别输入。考虑到界面的单调性，决定在上方加一个能够自动expand、自动hide的标题栏。选图的标准是希望能够反应我们对于用户发表动态的鼓励，并且在风格色调上与之前布局相似的查找好友相仿。最终选择了Andy Worhal以及他的那现在被自媒体用烂了的观点

> In the future, everybody will be world famous for fifteen minutes.
>
> ​																											Andy Warhol (1928-1987)

##### 2.11.2 实现

自动伸缩的标题栏采用的还是之前使用过的`CollapsingToolbarLayout`。在右上角单独加了一个`Button`用于监听点击的发布事件。下方两个`EditText`，一个由`GridLayoutManager`作为LayoutManager的`RecyclerView`，用于显示图片的网格。选择图片时使用了[Matisse](https://github.com/zhihu/Matisse)包，选择后，使用[Luban](https://github.com/Curzibn/Luban)进行图片压缩。

#### 2.12 不同的动画

![](.\pics\cat_rearrange.gif)![](.\pics\waiting_animation.gif)![](.\pics\refresh.gif)

以上分别为：分类排序、上传下载等待以及刷新的动画。

